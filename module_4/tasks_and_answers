Задание 4.1

SELECT 
    a.city,
    count(a.airport_name) AS airports_total
FROM dst_project.airports AS a
GROUP BY a.city
HAVING count(a.airport_name) > 1 

Задание 4.2

    4.2.1
    SELECT COUNT(DISTINCT f.status)
        FROM dst_project.flights AS f 

    4.2.2.
    SELECT COUNT(DISTINCT f.flight_id)
        FROM dst_project.flights AS f 
        WHERE f.status = 'Departed'

    4.2.3
    SELECT COUNT (s.seat_no)
        FROM dst_project.aircrafts AS a 
        LEFT JOIN dst_project.seats AS s ON a.aircraft_code = s.aircraft_code
        WHERE a.model = 'Boeing 777-300'

    4.2.4
    SELECT  COUNT (f.flight_id)
        FROM dst_project.flights AS f
        WHERE f.actual_arrival BETWEEN '2017-04-01' AND'2017-09-01' 
            AND f.status = 'Arrived'
      
Задание 4.3

    4.3.1
    SELECT  COUNT (f.flight_id)
        FROM dst_project.flights AS f
        WHERE f.status = 'Cancelled'
        
    4.3.2
    SELECT  COUNT (a.aircraft_code)
        FROM dst_project.aircrafts AS a
        WHERE a.model LIKE '%Boeing%' OR a.model LIKE '%Sukhoi Superjet%' OR a.model LIKE '%Airbus%' 
        GROUP BY a.model LIKE '%Boeing%',  a.model LIKE '%Sukhoi Superjet%', a.model LIKE '%Airbus%' 
    
    4.3.3
    SELECT   a.timezone,
            COUNT(a.timezone)
        FROM dst_project.airports AS a
        GROUP BY a.timezone
        ORDER BY 2 DESC
    
    4.4.4
    SELECT  f.flight_id,
            f.actual_departure - f.scheduled_departure AS Время_задержки
        FROM dst_project.flights AS f
        WHERE f.actual_departure notnull
        ORDER BY 2 desc
        LIMIT 1
        
Задание 4.4
    
    4.4.1
    SELECT  f.flight_id,
            f.scheduled_departure
        FROM dst_project.flights AS f
        ORDER BY 2
        LIMIT 1
    
    4.4.2
    -- 1) Находим разность между датами 
    -- 2) из получившегося времени извлекаем часы и переводим в минуты умножая на 60 
    -- 3) из получившегося времени извлекаем минуты и прибавляем к пункту 2
    -- 4) находим максимальное время
    SELECT MAX(EXTRACT(HOUR FROM (f.scheduled_arrival - f.scheduled_departure)) *60 + EXTRACT(MINUTE FROM (f.scheduled_arrival - f.scheduled_departure)))
        FROM dst_project.flights AS f
        
    4.4.3
    SELECT  f.flight_id,
            f.scheduled_arrival - f.scheduled_departure AS Длительность_рейса,
            departure_airport,
            arrival_airport
        FROM dst_project.flights AS f
        ORDER BY 2 DESC
        LIMIT 1
    
    4.4.4
    -- 1) Находим разность между датами 
    -- 2) из получившегося времени извлекаем часы и переводим в минуты умножая на 60 
    -- 3) из получившегося времени извлекаем минуты и прибавляем к пункту 2
    -- 4) находим среднее значение
    -- 5) округляем
    SELECT ROUND(AVG(EXTRACT(HOUR FROM (f.scheduled_arrival - f.scheduled_departure)) *60 + EXTRACT(MINUTE FROM (f.scheduled_arrival - f.scheduled_departure))))
        FROM dst_project.flights AS f
        
Задание 4.5

    4.5.1
    SELECT  a.model,
            s.fare_conditions,
            COUNT(s.seat_no)
        FROM dst_project.aircrafts AS a 
            LEFT JOIN dst_project.seats AS s ON a.aircraft_code = s.aircraft_code
        GROUP BY a.model, s.fare_conditions
        ORDER BY 1, 3 DESC
    
    
    4.5.2
    SELECT MIN(b.total_amount)
        FROM dst_project.bookings AS b
        
    4.5.3
    SELECT bp.seat_no
        FROM dst_project.tickets AS t 
            LEFT JOIN dst_project.boarding_passes AS bp ON t.ticket_no = bp.ticket_no
        WHERE t.passenger_id = '4313 788533'
    
